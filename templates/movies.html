{% extends "layout.html" %}
{% set active_page = "movies" %}
{% block title %}elokuvat{% endblock %}
{% block content %}
<details>
    <summary>Haku</summary>
    <form class="search" action="/movies" methods="GET" autocomplete="off">
        <label for="movie_name_q">Nimi sisältää</label>
        <input type="text" id="name_q" name="name" minlength=1 maxlength=200>
        <label>Vuosi</label>
        <div class="range">
            <input type="number" id="year_min_q" name="min_year" min="1900" max="2099" value="1900" step="1" required>
            <input type="number" id="year_max_q" name="max_year" min="1900" max="2099" value="2099" step="1" required>
        </div>
        <label>Kesto</label>
        <div class="range">
            <input type="number" id="runtime_min_q" name="min_runtime" min="1" max="2099" value="1" step="1" required>
            <input type="number" id="runtime_max_q" name="max_runtime" min="1" max="2099" value="2000" step="1" required>
        </div>
        <input type="hidden" name="sort" value="name">
        <input type="submit" value="Hae elokuvia">
    </form>
</details>
{% if session.username %}
<details>
    <summary>Eikö elokuvaa löydy listalta? Voit lisätä sen itse!</summary>
    <form action="/movies" method="POST" autocomplete="off">
        <label for="movie_name">Elokuvan nimi</label>
        <input type="text" id="movie_name" name="movie_name" minlength=1 maxlength=200 required>
        <label for="movie_name">Julkaisuvuosi</label>
        <input type="number" id="movie_year" name="movie_year" min="1900" max="2099" value="2023" step="1" required>
        <label for="movie_runtime">Kesto (minuuttia)</label>
        <input type="number" id="movie_runtime " name="movie_runtime" min="1" max="2000" required>
        <input type="submit" value="Lisää elokuva">
    </form>
</details>
<hr>
{% endif %}
{% if (movies|length) > 0 %}
<table>
    <tbody>
        <tr class="sortbar">
            <td><a href="/movies">Elokuva</a></td>
            <td><a href="/movies?sort=year">Vuosi</a></td>
            <td><a href="/movies?sort=runtime">Kesto</a></td>
            <td><a href="/movies?sort=score">Arvosana</a></td>
        </tr>
        {% for movie in movies %}
        <tr>
            <td><a href="/movie/{{movie.movie_id}}">{{movie.movie_name}}</a></td>
            <td>{{movie.movie_year}}</td>
            <td style="white-space: nowrap;">{{movie.movie_runtime}} min</td>
            <td>{% if movie.avg != None %} {{(movie.avg|round(2))}} {% else %}-{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
Elokuvia ei löytynyt...
{% endif %}
{% endblock %}